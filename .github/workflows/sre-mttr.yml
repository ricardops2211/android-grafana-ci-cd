name: Incidentes-MTTR-Grafana

on:
  push: { branches: ["reusable-sre-richie"] }
  workflow_dispatch: {}

jobs:
  cluster:
    uses: ./.github/workflows/gha_cluster.yml

  observability:
    needs: [cluster]
    uses: ./.github/workflows/gha_observability.yml
    secrets:
      GC_PROM_URL: ${{ secrets.GC_PROM_URL }} 
      
  incident:
    needs: [observability]
    uses: ./.github/workflows/gha_incident.yml
    secrets: inherit

  grafana:
    needs: [incident]
    uses: ./.github/workflows/gha_grafana.yml
    with:
      grafana_url: https://ricardops2211.grafana.net
      loki_ds_name: grafanacloud-ricardops2211-logs
      dashboard_uid: sre-mttr-lab
      dashboard_title: "SRE MTTR Lab"
    secrets: inherit
